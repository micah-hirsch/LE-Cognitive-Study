---
title: 'S. Bikulcius Thesis: Analysis'
author: "Micah E. Hirsch"
date: "2024-03-07"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Purpose

The purpose of this document is to report the results from the data analysis for S. Bikulcius' undergraduate thesis project. Analyses were conducted using R version 4.3.1.

```{r}

# Loading needed packages

library(tidyverse)
library(rio)
library(glmmTMB)
library(janitor)
library(ggpubr)
library(patchwork)
library(gt)
library(gtsummary)
library(ggridges)

# Loading saved data

## Pupil Dilation Data

pupil <- rio::import("Data/cleaned_data.csv") |>
  # Getting Analysis Window
  dplyr::filter(timebins >= 500) |>
  dplyr::group_by(subject, trial) |>
  dplyr::filter(timebins <= max(timebins) - 2000) |>
  dplyr::ungroup() |>
  # Getting Peak Pupil Dilation Value
  dplyr::group_by(subject, trial, speaker, code, rep_acc, target_number, correct_words) |>
  dplyr::summarize(peak_pupil = max(pupil.binned)) |>
  dplyr::ungroup()

## Cognitive Data

cog <- rio::import("Data/cleaned_cog_data.csv")

## Listener Demographics

demo <- rio::import("Data/cleaned_listener_demo.csv") |>
  dplyr::mutate(gender = factor(gender, levels = c("Man", "Woman", "Nonbinary", "Questioning", "Prefer not to answer")),
                ethnicity = factor(ethnicity, levels = c("Hispanic/Latino(a/e)", "Not Hispanic/Latino(a/e)", "Prefer not to answer")),
                race = factor(race, levels = c("white/Caucasian", "Black/African American", "Asian/Asian American",
                                               "Native Hawaiian or Other Pacific Islander", "Native American or Alaska Native",
                                               "Biracial or Multiracial", "Prefer not to answer", "Race not listed")),
                native_lang = factor(native_lang, c("American English", "Not American English")))
```


# Listener Characteristics

## Demographics

The participant age range is from 18 to 39 years old. All participants reported they were fluent in English. However, two participants indicated that their native language is not American English. Their native languages were Spanish and Turkish respectively.

```{r}

demo_table <- demo |>
  dplyr::select(age, gender, ethnicity, race, native_lang) |>
  tbl_summary(type = list(age ~ "continuous",
                          gender ~ "categorical",
                          ethnicity ~ "categorical",
                          race ~ "categorical",
                          native_lang ~ "categorical"),
              statistic = list(all_continuous() ~ "{mean} ({sd})",
                               all_categorical() ~ "{n} ({p}%)"),
              digits = list(everything() ~ c(2)),
              label = list(age ~ "Age",
                           gender ~ "Gender",
                           ethnicity ~ "Ethnicity",
                           race ~ "Race",
                           native_lang ~ "Native Language")) |>
  as_gt()

demo_table

demo_table |>
  gt::gtsave("Tables/demo_table.html")

```


## Cognition

It appears that the listeners in this analysis had about average working memory and cognitive flexibility skills. Their inhibitory control scores were slightly below average and they tend to have higher processing speed scores (on the heigher end in the average range). The score distributions for working memory, cognitive flexibility, and inhibitory control roughly follow a normal distribution. The scores for processing speed appears to have more variation overall, and potentially has a bimodal distribution.

### Descriptives

```{r}

cog_table <- cog |>
  dplyr::select(-subject) |>
  # Just using the age-corrected scores
  dplyr::select(ends_with("_c")) |>
  tbl_summary(statistic = list(all_continuous() ~ "{mean} ({sd})"),
              digits = list(everything() ~ c(2)),
              label = list(list_sort_c ~ "Working Memory",
                           flanker_c ~ "Inhibitory Control",
                           card_sort_c ~ "Cognitive Flexibility",
                           pattern_c ~ "Processing Speed")) |>
  as_gt()

cog_table

cog_table |>
  gt::gtsave("Tables/cog_table.html")

```

### Distribution

```{r}

cog |>
  dplyr::select(subject, ends_with("_c")) |>
  tidyr::pivot_longer(cols = list_sort_c:pattern_c,
                      names_to = "cog_measure",
                      values_to = "score") |>
  ggplot() +
  aes(x = score,
      y = cog_measure,
      color = cog_measure,
      fill = cog_measure) +
  geom_density_ridges(jittered_points = T,
                      position = position_points_jitter(width = 0.05, height = 0),
                      point_shape = '|', point_size = 3, point_alpha = 1, alpha = 0.5) +
  theme_classic()

```

```{r}

rm(demo, demo_table)

```


# Speaker Characteristics

```{r}

pupil <- pupil |>
  # removing trials with missing rep accuracy
  dplyr::mutate(rep_acc = ifelse(rep_acc == "", NA, rep_acc)) |>
  dplyr::filter(!is.na(rep_acc)) |>
  dplyr::mutate(speaker = factor(speaker, levels = c("Control", "ALS")),
                trial_c = trial - 6,
                rep_acc = factor(rep_acc, levels = c("accurate", "inaccurate")))

speaker_table <- pupil |>
  dplyr::select(subject, trial, speaker, correct_words, target_number, rep_acc) |>
  dplyr::distinct() |>
  dplyr::mutate(intel = (correct_words/target_number)*100) |>
  dplyr::select(-c(subject, trial, correct_words, target_number)) |>
  tbl_summary(by = speaker,
              type = list(intel ~ "continuous",
                          rep_acc ~ "categorical"),
              statistic = list(all_continuous() ~ "{mean} ({sd})",
                               all_categorical() ~ "{n} ({p}%)"),
              digits = list(everything() ~ c(2)),
              label = list(intel ~ "Intelligibility",
                           rep_acc ~ "Repetition Accuracy")) |>
  as_gt()

speaker_table

speaker_table |>
  gt::gtsave("Tables/speaker_table.html")

```

```{r}

rm(speaker_table, cog_table)

```

