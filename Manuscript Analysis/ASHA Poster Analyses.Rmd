---
title: "Poster Analysis"
author: "Micah Hirsch"
date: "2024-10-21"
output: 
  html_document:
    toc: true
    toc_float: true
    code_folding: hide
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Purpose

This document provides the code for the peak pupil dilation and perceived listening effort analyses for a poster presentation presented at the 2024 Annual Speech Language and Hearing Association Convention. The presentation information is below:

-   **Title:** The Relationship Between Listener Cognition and Listening Effort During Dysarthric Speech Perception

-   **Authors:** Samantha Bikulcius, Micah Hirsch, Stephanie Borrie, Yunjung Kim, Tyson Barrett, and Kaitlin Lansford

-   **Location:** Seattle, WA

-   **Date:** Saturday, Dec 7 10:00 AM

```{r, warning = F, message = F}

# Loading in the needed packages

library(tidyverse) # install.packages("tidyverse")
library(rio) # install.packages("rio")
library(glmmTMB) # install.packages("glmmTMB")
library(janitor) # install.packages("janitor")
library(ggpubr) # install.packages("ggpubr")
library(patchwork) # install.packages("patchwork")
library(gt) # install.packages("gt")
library(gtsummary) # install.packages("gtsummary")
library(ggridges) # install.packages("ggridges")
library(performance) # install.packages("performance")
library(sjPlot) # install.packages("sjPlot")
library(ggcorrplot) # install.packages("ggcorrplot")
library(see) #install.packages("see")

# Loading in the cog data

cog <- rio::import("Cleaned Data/cleaned_cog_data.csv") 

# Loading in the pupil data

pupil <- rio::import("Cleaned Data/cleaned_pupil_data_normalized.csv") 

# Loading in the phrase accuracy data

phrase_acc <- rio::import("Cleaned Data/repetition_accuracy.csv") |>
  dplyr::mutate(rep_acc = ifelse(initial_response == "missing data", NA, 
                                 ifelse(target_number == correct_words_initial, "accurate", "inaccurate")),
                rep_acc_rel = ifelse(rel_response == "missing data", NA, 
                                 ifelse(target_number == correct_words_rel, "accurate", "inaccurate"))) |>
  dplyr::select(subject, trial, rep_acc)


```

# Peak Pupil Dilation

```{r, warning = F, message = F}

peak_pupil_df <-pupil |>
  dplyr::group_by(subject, trial, speaker, code) |>
  dplyr::summarize(peak_pupil = max(normed_pupil)) |>
  dplyr::ungroup() |>
  dplyr::left_join(phrase_acc, by = c("subject", "trial")) |>
  dplyr::left_join(cog, by = "subject") |>
  dplyr::mutate(trial_c = trial - 6,
                speaker = factor(speaker, levels = c("Control", "ALS")),
                rep_acc = factor(rep_acc, levels = c("accurate", "inaccurate"))) |>
  dplyr::filter(!is.na(rep_acc))

```

## Visualization

```{r, warning = F, message = F}

# Color Palette for Figures
my_pal <- c("#25CED1", "#0D3B66", "#F75C03", "#3B5249", "#F1C40F", "#D90368")

peak_pupil_df |>
  dplyr::select(subject, trial, speaker, peak_pupil, rep_acc, ends_with("_c")) |>
  dplyr::group_by(subject, speaker, rep_acc, list_sort_c, flanker_c, card_sort_c, pattern_c) |>
  dplyr::summarize(peak_pupil = mean(peak_pupil)) |>
  dplyr::rename('Working Memory' = list_sort_c,
                'Inhibitory Control' = flanker_c,
                'Cognitive Flexibility' = card_sort_c,
                'Processing Speed' = pattern_c) |>
  tidyr::pivot_longer(cols = "Working Memory":"Processing Speed",
                     names_to = "cog_measure",
                     values_to = "score") |>
  ungroup() |>
  ggplot() +
  aes(x = score,
      y = peak_pupil,
      color = speaker,
      shape = speaker) +
  geom_point(alpha = 0.6) +
  geom_smooth(method = "lm") +
  facet_grid(cog_measure ~ rep_acc) +
  labs(x = "Score", y = "Peak Pupil Dilation") +
  theme_classic() +
  scale_color_manual(values = my_pal, labels = c("Neurotypical", "ALS") ) +
  scale_shape_manual(values = c(1, 2), labels = c("Neurotypical", "ALS")) +
  theme(aspect.ratio = 1,
        panel.spacing.x = unit(.8, "lines"),
        legend.position = "bottom")

ggsave("Figures/peak_pupil_plot.png", plot = last_plot(), width = 3, height = 6, units = "in", scale = 1.2)

```

## Models

### Fully Unconditional Model

```{r, warning = F, message = F}

m0 <- glmmTMB(peak_pupil ~ 1 + (1|subject), data = peak_pupil_df)
sjPlot::tab_model(m0, pred.labels = "Intercept",
                  dv.labels = "Peak Pupil Dilation")

performance::icc(m0)
performance::check_model(m0)

```

### Model 1

```{r}

m1 <- glmmTMB(peak_pupil ~ 1 + (trial_c|subject), data = peak_pupil_df)
sjPlot::tab_model(m1, pred.labels = "Intercept",
                  dv.labels = "Peak Pupil Dilation")
performance::test_performance(m0, m1)

```

### Model 2

```{r, warning = F, message = F}

m2 <- glmmTMB(peak_pupil ~ trial_c + speaker*rep_acc + (trial_c|subject), data = peak_pupil_df)
sjPlot::tab_model(m2, 
                  pred.labels = c("Intercept", "Trial Number", "Speaker [ALS]", "Repetition Accuracy [Inaccurate]",
                                  "Speaker * Repetition Accuracy"),
                  dv.labels = "Peak Pupil Dilation")
performance::test_performance(m1, m2)

```

### Model 3

```{r, warning = F, message = F}

m3 <- glmmTMB(peak_pupil ~ trial_c + speaker*rep_acc + scale(list_sort_c, scale = F) + (1|subject), data = peak_pupil_df)
sjPlot::tab_model(m3, 
                  pred.labels = c("Intercept", "Trial Number", "Speaker [ALS]", "Repetition Accuracy [Inaccurate]",
                                  "Working Memory", "Speaker * Repetition Accuracy"),
                  dv.labels = "Peak Pupil Dilation")
performance::test_performance(m2, m3)

```

### Model 3b

```{r, warning = F, message = F}

m3b <- glmmTMB(peak_pupil ~ trial_c + speaker*rep_acc + (1|subject), data = peak_pupil_df)
sjPlot::tab_model(m3b,
                  pred.labels = c("Intercept", "Trial Number", "Speaker [ALS]", "Repetition Accuracy [Inaccurate]", 
                                  "Speaker * Repetition Accuracy"),
                  dv.labels = "Peak Pupil Dilation")
performance::test_performance(m3, m3b)

```

### Model 4

```{r, warning = F, message = F}

m4 <- glmmTMB(peak_pupil ~ trial_c + speaker*rep_acc + scale(flanker_c, scale = F) + (1|subject), data = peak_pupil_df)
sjPlot::tab_model(m4, 
                  pred.labels = c("Intercept", "Trial Number", "Speaker [ALS]", "Repetition Accuracy [Inaccurate]",
                                  "Inhibitory Control", "Speaker * Repetition Accuracy"),
                  dv.labels = "Peak Pupil Dilation")
performance::test_performance(m3b, m4)

```

### Model 5

```{r, warning = F, message = F}

m5 <- glmmTMB(peak_pupil ~ trial_c + speaker*rep_acc + scale(card_sort_c, scale = F) + (1|subject), data = peak_pupil_df)
sjPlot::tab_model(m5, 
                  pred.labels = c("Intercept", "Trial Number", "Speaker [ALS]", "Repetition Accuracy [Inaccurate]",
                                  "Cognitive Flexibility", "Speaker * Repetition Accuracy"),
                  dv.labels = "Peak Pupil Dilation")
performance::test_performance(m3b, m5)

```

### Model 6

```{r, warning = F, messgae = F}

m6 <- glmmTMB(peak_pupil ~ trial_c + speaker*rep_acc + scale(pattern_c,scale = F) + (1|subject), data = peak_pupil_df)
sjPlot::tab_model(m6, 
                  pred.labels = c("Intercept", "Trial Number", "Speaker [ALS]", "Repetition Accuracy [Inaccurate]",
                                  "Processing Speed", "Speaker * Repetition Accuracy"),
                  dv.labels = "Peak Pupil Dilation")
performance::test_performance(m3b, m6)

```

### Model 7

```{r, warning = F, message = F}

m7 <- glmmTMB(peak_pupil ~ trial_c + speaker*rep_acc + 
                speaker*scale(list_sort_c, scale = F) + (1|subject), data = peak_pupil_df)
sjPlot::tab_model(m7, 
                  pred.labels = c("Intercept", "Trial Number", "Speaker [ALS]", "Repetition Accuracy [Inaccurate]",
                                  "Working Memory", "Speaker * Repetition Accuracy", "Working Memory * Speaker [ALS]"),
                  dv.labels = "Peak Pupil Dilation")
performance::test_performance(m3b, m7)

```

### Model 8

```{r, warning = F, message = F}

m8 <- glmmTMB(peak_pupil ~ trial_c + speaker*rep_acc + 
                speaker*scale(list_sort_c, scale = F) + speaker*scale(flanker_c, scale = F) + (1|subject), data = peak_pupil_df)
sjPlot::tab_model(m8, 
                  pred.labels = c("Intercept", "Trial Number", "Speaker [ALS]", "Repetition Accuracy [Inaccurate]",
                                  "Working Memory", "Inhibitory Control", 
                                  "Speaker * Repetition Accuracy", "Working Memory * Speaker [ALS]",
                                  "Inhibitory Control * Speaker [ALS]"),
                  dv.labels = "Peak Pupil Dilation")
performance::test_performance(m7, m8)

```

### Model 9

```{r, warning = F, message = F}

m9 <- glmmTMB(peak_pupil ~ trial_c + speaker*rep_acc + 
                speaker*scale(list_sort_c, scale = F) + speaker*scale(card_sort_c, scale = F) + (1|subject), data = peak_pupil_df)
sjPlot::tab_model(m9, 
                   pred.labels = c("Intercept", "Trial Number", "Speaker [ALS]", "Repetition Accuracy [Inaccurate]",
                                  "Working Memory", "Cognitive Flexibility",
                                  "Speaker * Repetition Accuracy", "Working Memory * Speaker [ALS]",
                                  "Cognitive Flexibility * Speaker [ALS]"),
                  dv.labels = "Peak Pupil Dilation")
performance::test_performance(m7, m9)

```

### Model 10

```{r, warning = F, message = F}

m10 <- glmmTMB(peak_pupil ~ trial_c + speaker*rep_acc + 
                speaker*scale(list_sort_c, scale = F) + speaker*scale(card_sort_c, scale = F) + speaker*scale(pattern_c, scale = F) +
                 (1|subject), data = peak_pupil_df)
sjPlot::tab_model(m10, 
                  pred.labels = c("Intercept", "Trial Number", "Speaker [ALS]", "Repetition Accuracy [Inaccurate]",
                                  "Working Memory", "Cognitive Flexibility", "Processing Speed",
                                  "Speaker * Repetition Accuracy", "Working Memory * Speaker [ALS]",
                                  "Cognitive Flexibility * Speaker [ALS]", "Processing Speed * Speaker [ALS]"),
                  dv.labels = "Peak Pupil Dilation")
performance::test_performance(m9, m10)

```

### Model 11

```{r, warning = F, message = F}

m11 <- glmmTMB(peak_pupil ~ trial_c + speaker*rep_acc + 
                 speaker*scale(list_sort_c, scale = F) + speaker*scale(card_sort_c, scale = F) + 
                 rep_acc*scale(list_sort_c, scale = F) +
                 (1|subject), data = peak_pupil_df)
sjPlot::tab_model(m11, 
                  pred.labels = c("Intercept", "Trial Number", "Speaker [ALS]", "Repetition Accuracy [Inaccurate]",
                                  "Working Memory", "Cognitive Flexibility", 
                                  "Speaker * Repetition Accuracy", "Working Memory * Speaker [ALS]",
                                  "Cognitive Flexibility * Speaker [ALS]", 
                                  "Working Memory * Accuracy [Inaccuraate]"),
                  dv.labels = "Peak Pupil Dilation")
performance::test_performance(m9, m11)

```

### Model 12

```{r, warning = F, message = F}

m12 <- glmmTMB(peak_pupil ~ trial_c + speaker*rep_acc + 
                 speaker*scale(list_sort_c, scale = F) + speaker*scale(card_sort_c, scale = F) + 
                 rep_acc*scale(list_sort_c, scale = F) + rep_acc*scale(flanker_c, scale = F) +
                 (1|subject), data = peak_pupil_df)
sjPlot::tab_model(m12, 
                  pred.labels = c("Intercept", "Trial Number", "Speaker [ALS]", "Repetition Accuracy [Inaccurate]",
                                  "Working Memory", "Cognitive Flexibility", "Inhibitory Control",
                                  "Speaker * Repetition Accuracy", "Working Memory * Speaker [ALS]",
                                  "Cognitive Flexibility * Speaker [ALS]", 
                                  "Working Memory * Accuracy [Inaccurate]",
                                  "Inhibitory Control * Accuracy [Inaccurate]"),
                  dv.labels = "Peak Pupil Dilation")
performance::test_performance(m11, m12)

```

### Model 13

```{r, warning = F, message = F}

m13 <- glmmTMB(peak_pupil ~ trial_c + speaker*rep_acc + 
                 speaker*scale(list_sort_c, scale = F) + speaker*scale(card_sort_c, scale = F) + 
                 rep_acc*scale(list_sort_c, scale = F) + rep_acc*scale(card_sort_c, scale = F) +
                 (1|subject), data = peak_pupil_df)
sjPlot::tab_model(m13, 
                  pred.labels = c("Intercept", "Trial Number", "Speaker [ALS]", "Repetition Accuracy [Inaccurate]",
                                  "Working Memory", "Cognitive Flexibility",
                                  "Speaker * Repetition Accuracy", "Working Memory * Speaker [ALS]",
                                  "Cognitive Flexibility * Speaker [ALS]", 
                                  "Working Memory * Accuracy [Inaccurate]",
                                  "Cognitive Flexibility * Accuracy [Inaccurate]"),
                  dv.labels = "Peak Pupil Dilation")
performance::test_performance(m11, m13)


```

### Model 14

```{r, wrning = F, message = F}

m14 <- glmmTMB(peak_pupil ~ trial_c + speaker*rep_acc + 
                 speaker*scale(list_sort_c, scale = F) + speaker*scale(card_sort_c, scale = F) + 
                 rep_acc*scale(list_sort_c, scale = F) + rep_acc*scale(pattern_c, scale = F) +
                 (1|subject), data = peak_pupil_df)
sjPlot::tab_model(m14, 
                  pred.labels = c("Intercept", "Trial Number", "Speaker [ALS]", "Repetition Accuracy [Inaccurate]",
                                  "Working Memory", "Cognitive Flexibility", "Processing Speed",
                                  "Speaker * Repetition Accuracy", "Working Memory * Speaker [ALS]",
                                  "Cognitive Flexibility * Speaker [ALS]", 
                                  "Working Memory * Accuracy [Inaccurate]",
                                  "Processing Speed * Accuracy [Inaccurate]"),
                  dv.labels = "Peak Pupil Dilation")
performance::test_performance(m11, m14)

```

### Model 15

```{r, warning = F, message = F}

m15 <- glmmTMB(peak_pupil ~ trial_c + speaker*rep_acc + 
                 speaker*scale(list_sort_c, scale = F) + speaker*scale(card_sort_c, scale = F) + 
                 rep_acc*scale(list_sort_c, scale = F) + rep_acc*scale(pattern_c, scale = F) +
                 speaker*rep_acc*scale(list_sort_c, scale = F) +
                 (1|subject), data = peak_pupil_df)
sjPlot::tab_model(m15, 
                  pred.labels = c("Intercept", "Trial Number", "Speaker [ALS]", "Repetition Accuracy [Inaccurate]",
                                  "Working Memory", "Cognitive Flexibility", "Processing Speed",
                                  "Speaker * Repetition Accuracy", "Working Memory * Speaker [ALS]",
                                  "Cognitive Flexibility * Speaker [ALS]", 
                                  "Working Memory * Accuracy [Inaccurate]",
                                  "Processing Speed * Accuracy [Inaccurate]",
                                  "Working Memory * Speaker * Accuracy"),
                  dv.labels = "Peak Pupil Dilation")
performance::test_performance(m14, m15)

```

### Model 16

```{r, warning = F, message = F}

m16 <- glmmTMB(peak_pupil ~ trial_c + speaker*rep_acc + 
                 speaker*scale(list_sort_c, scale = F) + speaker*scale(card_sort_c, scale = F) + 
                 rep_acc*scale(list_sort_c, scale = F) + rep_acc*scale(pattern_c, scale = F) +
                 speaker*rep_acc*scale(flanker_c, scale = F) +
                 (1|subject), data = peak_pupil_df)
sjPlot::tab_model(m16, 
                  pred.labels = c("Intercept", "Trial Number", "Speaker [ALS]", "Repetition Accuracy [Inaccurate]",
                                  "Working Memory", "Cognitive Flexibility", "Processing Speed", "Inhibitory Control",
                                  "Speaker * Repetition Accuracy", "Working Memory * Speaker [ALS]",
                                  "Cognitive Flexibility * Speaker [ALS]", 
                                  "Working Memory * Accuracy [Inaccurate]",
                                  "Processing Speed * Accuracy [Inaccurate]",
                                  "Inhibitory Control * Speaker [ALS]",
                                  "Inhibitory Control * Accuracy [Inaccurate]",
                                  "Inhibitory Control * Speaker * Accuracy"),
                  dv.labels = "Peak Pupil Dilation")
performance::test_performance(m14, m16)


```

### Model 17

```{r, warning = F, message = F}

m17 <- glmmTMB(peak_pupil ~ trial_c + speaker*rep_acc + 
                 speaker*scale(list_sort_c, scale = F) + speaker*scale(card_sort_c, scale = F) + 
                 rep_acc*scale(list_sort_c, scale = F) + rep_acc*scale(pattern_c, scale = F) +
                 speaker*rep_acc*scale(card_sort_c, scale = F) +
                 (1|subject), data = peak_pupil_df)
sjPlot::tab_model(m17, 
                  pred.labels = c("Intercept", "Trial Number", "Speaker [ALS]", "Repetition Accuracy [Inaccurate]",
                                  "Working Memory", "Cognitive Flexibility", "Processing Speed",
                                  "Speaker * Repetition Accuracy", "Working Memory * Speaker [ALS]",
                                  "Cognitive Flexibility * Speaker [ALS]", 
                                  "Working Memory * Accuracy [Inaccurate]",
                                  "Processing Speed * Accuracy [Inaccurate]",
                                  "Cognitive Flexibility * Accuracy [Inaccurate]",
                                  "Cognitive Flexibility * Speaker * Accuracy"),
                  dv.labels = "Peak Pupil Dilation")
performance::test_performance(m14, m17)

```

### Model 18

```{r, warning = F, message = F}

m18 <- glmmTMB(peak_pupil ~ trial_c + speaker*rep_acc + 
                 speaker*scale(list_sort_c, scale = F) + speaker*scale(card_sort_c, scale = F) + 
                 rep_acc*scale(list_sort_c, scale = F) + rep_acc*scale(pattern_c, scale = F) +
                 speaker*rep_acc*scale(pattern_c, scale = F) +
                 (1|subject), data = peak_pupil_df)
sjPlot::tab_model(m18, 
                  pred.labels = c("Intercept", "Trial Number", "Speaker [ALS]", "Repetition Accuracy [Inaccurate]",
                                  "Working Memory", "Cognitive Flexibility", "Processing Speed",
                                  "Speaker * Repetition Accuracy", "Working Memory * Speaker [ALS]",
                                  "Cognitive Flexibility * Speaker [ALS]", 
                                  "Working Memory * Accuracy [Inaccurate]",
                                  "Processing Speed * Accuracy [Inaccurate]",
                                  "Processing Speed * Speaker [ALS]",
                                  "Processing Speed * Speaker * Accuracy"),
                  dv.labels = "Peak Pupil Dilation")
performance::test_performance(m14, m18)

```

### Removing the interaction between repetition accuracy and working memory

```{r, warning = F, message = F}

m14b <- glmmTMB(peak_pupil ~ trial_c + speaker*rep_acc + 
                  speaker*scale(list_sort_c, scale = F) + speaker*scale(card_sort_c, scale = F) + 
                  rep_acc*scale(pattern_c, scale = F) +
                  (1|subject), data = peak_pupil_df)
sjPlot::tab_model(m14b, 
                  pred.labels = c("Intercept", "Trial Number", "Speaker [ALS]", "Repetition Accuracy [Inaccurate]",
                                  "Working Memory", "Cognitive Flexibility", "Processing Speed", 
                                  "Speaker * Repetition Accuracy", "Working Memory * Speaker [ALS]",
                                  "Cognitive Flexibility * Speaker [ALS]",
                                  "Processing Speed * Repetition Accuracy [Inacccurate]"),
                  dv.labels = "Peak Pupil Dilation")
performance::test_performance(m14, m14b)

```

### Best Fitting Final Model

This is the best fitting model for the pupil dilation data. Model assumptions were also visually checked using the performance package. In regards to the cognitive data, here are the key take-aways:

-   Interaction between Working Memory and Speaker: On average, when listening to the ALS speaker, listeners with higher working memory scores had greater peak pupil dilation.
-   Interaction between Cognitive Flexibility and Speaker: On average, when listening to the ALS speaker, listeners with greater cognitive flexibility scores had larger peak pupil dilation values.
-   Interaction between processing speed and repetition accuracy: On average, when the phrase was inaccurately recognized, listeners with greater processing speed had greater peak pupil dilation.
-   The three way interaction between speaker, repetition accuracy, and each cognitive measure of interest was tested. However, none of them were significant. This indicates that the pattern in pupil response did not differ much between accurate and inaccurately recognized phrases for the ALS speaker (for working memory and cognitive flexibility). Additionally, the pattern of pupil response did not significantly differ between inaccurately-recognized control and ALS speakers for processing speed.

```{r, warning = F, message = F}

m14c <- glmmTMB(peak_pupil ~ trial_c + speaker + rep_acc + 
                  speaker*scale(list_sort_c, scale = F) + speaker*scale(card_sort_c, scale = F) + 
                  rep_acc*scale(pattern_c, scale = F) +
                  (1|subject), data = peak_pupil_df)
sjPlot::tab_model(m14c, 
                  pred.labels = c("Intercept", "Trial Number", "Speaker [ALS]", "Repetition Accuracy [Inaccurate]",
                                  "Working Memory", "Cognitive Flexibility", "Processing Speed", 
                                  "Working Memory * Speaker [ALS]",
                                  "Cognitive Flexibility * Speaker [ALS]", 
                                  "Processing Speed * Repetition Accuracy [Inacccurate]"),
                  dv.labels = "Peak Pupil Dilation",
                  show.std = T,
                  file = "Tables/Peak_pupil_model.html")
performance::check_model(m14c)
performance::test_performance(m14b, m14c)

```

# Perceived Listening Effort

## Visualizations

```{r}

# Merge PLE data with rep acc and listener cog

ple <- rio::import("Cleaned Data\\cleaned_ple_data.csv")

ple <- ple |>
  dplyr::left_join(phrase_acc, by = c("subject", "trial")) |>
  dplyr::filter(!is.na(rep_acc)) |>
  dplyr::left_join(cog, by = "subject") |>
  dplyr::filter(effort_rating > 0) |>
  dplyr::filter(effort_rating <= 7) |>
  dplyr::mutate(trial_c = trial - 6,
                speaker = factor(speaker, levels = c("Control", "ALS")))

ple |>
  dplyr::select(subject, trial, speaker, code, effort_rating, rep_acc, ends_with("_c")) |>
  dplyr::group_by(subject, speaker, rep_acc, list_sort_c, flanker_c, card_sort_c, pattern_c) |>
  dplyr::summarize(effort = mean(effort_rating)) |>
  dplyr::rename('Working Memory' = list_sort_c,
                'Inhibitory Control' = flanker_c,
                'Cognitive Flexibility' = card_sort_c,
                'Processing Speed' = pattern_c) |>
  tidyr::pivot_longer(cols = "Working Memory":"Processing Speed",
                     names_to = "cog_measure",
                     values_to = "score") |>
  ungroup() |>
  ggplot() +
  aes(x = score,
      y = effort,
      color = speaker,
      shape = speaker) +
  geom_point(alpha = 0.6) +
  geom_smooth(method = "lm") +
  facet_grid(cog_measure ~ rep_acc) +
  labs(x = "Score", y = "Perceived Listening Effort Rating") +
  theme_classic() +
  scale_color_manual(values = my_pal, labels = c("Neurotypical", "ALS")) +
  scale_shape_manual(values = c(1, 2), labels = c("Neurotypical", "ALS")) +
  theme(aspect.ratio = 1,
        panel.spacing.x = unit(.8, "lines"),
        legend.position = "bottom")

ggsave("Figures/ple_plot_cog.png", plot = last_plot(), width = 3, height = 6, units = "in", scale = 1.2)

```

## Models

### Fully Unconditional Model

```{r, warning = F, message = F}

m0 <- glmmTMB(effort_rating ~ 1 + (1|subject) + (1|code), data = ple)
sjPlot::tab_model(m0, 
                  pred.labels = "Intercept",
                  dv.labels = "Perceived Listening Effort")
performance::icc(m0)
performance::check_model(m0)

```

### Model 1

In this step, we are adding trial order (trial_c) as a random slop for both the listener (subject) and phrase (code) random intercepts. The random intercept of trial order significantly improved model fit.

```{r, warning = F, message = F}

m1<- glmmTMB(effort_rating ~ 1 + (trial_c|subject) + (trial_c|code), data = ple)
sjPlot::tab_model(m1, pred.labels = "Intercept",
                  dv.labels = "Perceived Listening Effort")
performance::test_performance(m0, m1)

```

### Model 2

```{r, warning = F, message = F}

m2 <- glmmTMB(effort_rating ~ trial_c + speaker*rep_acc + (trial_c|subject) + (trial_c|code), data = ple)
sjPlot::tab_model(m2,
                  pred.labels = c("Intercept", "Trial Number", "Speaker [ALS]",
                                  "Repetition Accuracy [Inaccurate]", "Speaker * Repetition Accuracy"),
                  dv.labels = "Perceived Listening Effort")

performance::test_performance(m1, m2)

```

### Model 3

```{r, warning = F, message = F}

m3 <- glmmTMB(effort_rating ~ trial_c + speaker*rep_acc + scale(list_sort_c, scale = F) +(trial_c|subject) + (trial_c|code), data = ple)
sjPlot::tab_model(m3,
                  pred.labels = c("Intercept", "Trial Number", "Speaker [ALS]",
                                  "Repetition Accuracy [Inaccurate]", "Working Memory",
                                  "Speaker * Repetition Accuracy"),
                  dv.labels = "Perceived Listening Effort")

performance::test_performance(m2, m3)

```

### Model 4

```{r, warning = F, message = F}

m4 <- glmmTMB(effort_rating ~ trial_c + speaker*rep_acc + scale(flanker_c, scale = F) +(trial_c|subject) + (trial_c|code), data = ple)
sjPlot::tab_model(m4,
                  pred.labels = c("Intercept", "Trial Number", "Speaker [ALS]",
                                  "Repetition Accuracy [Inaccurate]", "Inhibitory Control",
                                  "Speaker * Repetition Accuracy"),
                  dv.labels = "Perceived Listening Effort")

performance::test_performance(m2, m4)

```

### Model 5

```{r, warning = F, message = F}

m5 <- glmmTMB(effort_rating ~ trial_c + speaker*rep_acc + scale(card_sort_c, scale = F) +(trial_c|subject) + (trial_c|code), data = ple)
sjPlot::tab_model(m5,
                  pred.labels = c("Intercept", "Trial Number", "Spekaer [ALS]",
                                  "Repetition Accuracy [Inaccurate]", "Cognitive Flexibility",
                                  "Speaker * Repetition Accuracy"),
                  dv.labels = "Perceived Listening Effort")

performance::test_performance(m2, m5)

```

### Model 6

```{r, warning = F, message = F}

m6 <- glmmTMB(effort_rating ~ trial_c + speaker*rep_acc + scale(pattern_c, scale = F) +(trial_c|subject) + (trial_c|code), data = ple)
sjPlot::tab_model(m6,
                  pred.labels = c("Intercept", "Trial Number", "Spekaer [ALS]",
                                  "Repetition Accuracy [Inaccurate]", "Processing Speed",
                                  "Speaker * Repetition Accuracy"),
                  dv.labels = "Perceived Listening Effort")

performance::test_performance(m2, m6)


```

### Model 7

```{r}

m7 <- glmmTMB(effort_rating ~ trial_c + speaker*rep_acc + 
                speaker*scale(list_sort_c, scale = F) + (trial_c|subject) + (trial_c|code), data = ple)
sjPlot::tab_model(m7,
                  pred.labels = c("Intercept", "Trial Number", "Spekaer [ALS]",
                                  "Repetition Accuracy [Inaccurate]", "Working Memory",
                                  "Speaker * Repetition Accuracy",
                                  "Working Memory * Speaker [ALS]"),
                  dv.labels = "Perceived Listening Effort")

performance::test_performance(m2, m7)

```

### Model 8

```{r, warning = F, message = F}

m8 <- glmmTMB(effort_rating ~ trial_c + speaker*rep_acc + 
                speaker*scale(list_sort_c, scale = F) + speaker*scale(flanker_c, scale = F) + 
                (trial_c|subject) + (trial_c|code), data = ple)
sjPlot::tab_model(m8,
                  pred.labels = c("Intercept", "Trial Number", "Spekaer [ALS]",
                                  "Repetition Accuracy [Inaccurate]", "Working Memory", "Inhibitory Control",
                                  "Speaker * Repetition Accuracy",
                                  "Working Memory * Speaker [ALS]", "Inhibitory Control * Speaker [ALS]"),
                  dv.labels = "Perceived Listening Effort")

performance::test_performance(m7, m8)

```

### Model 9

```{r, warning = F, message = F}

m9 <- glmmTMB(effort_rating ~ trial_c + speaker*rep_acc + 
                speaker*scale(list_sort_c, scale = F) + speaker*scale(card_sort_c, scale = F) + 
                (trial_c|subject) + (trial_c|code), data = ple)
sjPlot::tab_model(m9,
                  pred.labels = c("Intercept", "Trial Number", "Spekaer [ALS]",
                                  "Repetition Accuracy [Inaccurate]", "Working Memory", "Cognitive Flexibility",
                                  "Speaker * Repetition Accuracy",
                                  "Working Memory * Speaker [ALS]", "Cognitive Flexibility * Speaker [ALS]"),
                  dv.labels = "Perceived Listening Effort")

performance::test_performance(m7, m9)

```

### Model 10

```{r, warning = F, message = F}

m10 <- glmmTMB(effort_rating ~ trial_c + speaker*rep_acc + 
                speaker*scale(list_sort_c, scale = F) + speaker*scale(card_sort_c, scale = F) + 
                 speaker*scale(pattern_c, scale = F) +
                (trial_c|subject) + (trial_c|code), data = ple)
sjPlot::tab_model(m10, 
                  pred.labels = c("Intercept", "Trial Number", "Speaker [ALS]",
                                  "Repetition Accuracy [Inaccurate]", "Working Memory", "Cognitive Flexibility",
                                  "Processing Speed",
                                  "Speaker * Repetition Accuracy",
                                  "Working Memory * Speaker [ALS]", "Cognitive Flexibility * Speaker [ALS]"),
                  dv.labels = "Perceived Listening Effort")

performance::test_performance(m9, m10)

```

### Model 11

```{r, warning = F, message = F}

m11 <- glmmTMB(effort_rating ~ trial_c + speaker*rep_acc + 
                 speaker*scale(list_sort_c, scale = F) + speaker*scale(card_sort_c, scale = F) +
                 rep_acc*scale(list_sort_c, scale = F) +
                (trial_c|subject) + (trial_c|code), data = ple)
sjPlot::tab_model(m11, 
                  pred.labels = c("Intercept", "Trial Number", "Speaker [ALS]",
                                  "Repetition Accuracy [Inaccurate]", "Working Memory", "Cognitive Flexibility",
                                  "Speaker * Repetition Accuracy",
                                  "Working Memory * Speaker [ALS]", "Cognitive Flexibility * Speaker [ALS]", 
                                  "Working Memory * Repetition Accuracy [Inaccurate]"),
                  dv.labels = "Perceived Listening Effort")

performance::test_performance(m9, m11)

```

### Model 12

```{r, warning = F, message = F}

m12 <- glmmTMB(effort_rating ~ trial_c + speaker*rep_acc + 
                 speaker*scale(list_sort_c, scale = F) + speaker*scale(card_sort_c, scale = F) +
                 rep_acc*scale(list_sort_c, scale = F) + rep_acc*scale(flanker_c, scale = F) +
                (trial_c|subject) + (trial_c|code), data = ple)
sjPlot::tab_model(m12, 
                  pred.labels = c("Intercept", "Trial Number", "Speaker [ALS]",
                                  "Repetition Accuracy [Inaccurate]", "Working Memory", "Cognitive Flexibility",
                                  "Inhibitory Control", "Speaker * Repetition Accuracy",
                                  "Working Memory * Speaker [ALS]", "Cognitive Flexibility * Speaker [ALS]", 
                                  "Working Memory * Repetition Accuracy [Inaccurate]",
                                  "Inhibitory Control * Repetition Accuracy [Inaccurate]"),
                  dv.labels = "Perceived Listening Effort")

performance::test_performance(m11, m12)

```

### Model 13

```{r, warning = F, message = F}

m13 <- glmmTMB(effort_rating ~ trial_c + speaker*rep_acc + 
                 speaker*scale(list_sort_c, scale = F) + speaker*scale(card_sort_c, scale = F) +
                 rep_acc*scale(list_sort_c, scale = F) + rep_acc*scale(card_sort_c, scale = F) +
                (trial_c|subject) + (trial_c|code), data = ple)
sjPlot::tab_model(m13, 
                  pred.labels = c("Intercept", "Trial Number", "Speaker [ALS]",
                                  "Repetition Accuracy [Inaccurate]", "Working Memory", "Cognitive Flexibility",
                                  "Speaker * Repetition Accuracy",
                                  "Working Memory * Speaker [ALS]", "Cognitive Flexibility * Speaker [ALS]", 
                                  "Working Memory * Repetition Accuracy [Inaccurate]",
                                  "Cognitive Flexibility * Repetition Accuracy [Inaccurate]"),
                  dv.labels = "Perceived Listening Effort")

performance::test_performance(m11, m13)

```

### Model 14

```{r, warning = F, message = F}

m14 <- glmmTMB(effort_rating ~ trial_c + speaker*rep_acc + 
                 speaker*scale(list_sort_c, scale = F) + speaker*scale(card_sort_c, scale = F) +
                 rep_acc*scale(list_sort_c, scale = F) + rep_acc*scale(card_sort_c, scale = F) +
                 rep_acc*scale(pattern_c, scale = F) +
                (trial_c|subject) + (trial_c|code), data = ple)
sjPlot::tab_model(m14, 
                  pred.labels = c("Intercept", "Trial Number", "Speaker [ALS]",
                                  "Repetition Accuracy [Inaccurate]", "Working Memory", "Cognitive Flexibility",
                                  "Processing Speed", "Speaker * Repetition Accuracy",
                                  "Working Memory * Speaker [ALS]", "Cognitive Flexibility * Speaker [ALS]", 
                                  "Working Memory * Repetition Accuracy [Inaccurate]",
                                  "Cognitive Flexibility * Repetition Accuracy [Inaccurate]",
                                  "Processing Speed * Repetition Accuracy [Inaccurate]"),
                  dv.labels = "Perceived Listening Effort")

performance::test_performance(m13, m14)

```

### Model 15

```{r, warning = F, message = F}

m15 <- glmmTMB(effort_rating ~ trial_c + speaker*rep_acc + 
                 speaker*scale(list_sort_c, scale = F) + speaker*scale(card_sort_c, scale = F) +
                 rep_acc*scale(list_sort_c, scale = F) + rep_acc*scale(card_sort_c, scale = F) +
                 speaker*rep_acc*scale(list_sort_c, scale = F) +
                (trial_c|subject) + (trial_c|code), data = ple)
sjPlot::tab_model(m15, 
                  pred.labels = c("Intercept", "Trial Number", "Speaker [ALS]",
                                  "Repetition Accuracy [Inaccurate]", "Working Memory", "Cognitive Flexibility", 
                                  "Speaker * Repetition Accuracy",
                                  "Working Memory * Speaker [ALS]", "Cognitive Flexibility * Speaker [ALS]", 
                                  "Working Memory * Repetition Accuracy [Inaccurate]",
                                  "Cognitive Flexibility * Repetition Accuracy [Inaccurate]",
                                  "Working Memory * Speaker * Accuracy"),
                  dv.labels = "Perceived Listening Effort")

performance::test_performance(m13, m15)

```

### Model 16

```{r, warning = F, message = F}

m16 <- glmmTMB(effort_rating ~ trial_c + speaker*rep_acc + 
                 speaker*scale(list_sort_c, scale = F) + speaker*scale(card_sort_c, scale = F) +
                 rep_acc*scale(list_sort_c, scale = F) + rep_acc*scale(card_sort_c, scale = F) +
                 speaker*rep_acc*scale(flanker_c, scale = F) +
                (trial_c|subject) + (trial_c|code), data = ple)
sjPlot::tab_model(m16, 
                  pred.labels = c("Intercept", "Trial Number", "Speaker [ALS]",
                                  "Repetition Accuracy [Inaccurate]", "Working Memory", "Cognitive Flexibility", 
                                  "Inhibitory Control", "Speaker * Repetition Accuracy",
                                  "Working Memory * Speaker [ALS]", "Cognitive Flexibility * Speaker [ALS]", 
                                  "Working Memory * Repetition Accuracy [Inaccurate]",
                                  "Cognitive Flexibility * Repetition Accuracy [Inaccurate]",
                                  "Inhibitory Control * Speaker [ALS]", 
                                  "Inhibitory Control * Repetition Accuracy [Inaccurate]",
                                  "Inhibitory Control * Speaker * Accuracy"),
                  dv.labels = "Perceived Listening Effort")

performance::test_performance(m13, m16)

```

### Model 17

```{r, warning = F, message = F}

m17 <- glmmTMB(effort_rating ~ trial_c + speaker*rep_acc + 
                 speaker*scale(list_sort_c, scale = F) + speaker*scale(card_sort_c, scale = F) +
                 rep_acc*scale(list_sort_c, scale = F) + rep_acc*scale(card_sort_c, scale = F) +
                 speaker*rep_acc*scale(card_sort_c, scale = F) +
                (trial_c|subject) + (trial_c|code), data = ple)
sjPlot::tab_model(m17, 
                  pred.labels = c("Intercept", "Trial Number", "Speaker [ALS]",
                                  "Repetition Accuracy [Inaccurate]", "Working Memory", "Cognitive Flexibility", 
                                  "Speaker * Repetition Accuracy",
                                  "Working Memory * Speaker [ALS]", "Cognitive Flexibility * Speaker [ALS]", 
                                  "Working Memory * Repetition Accuracy [Inaccurate]",
                                  "Cognitive Flexibility * Repetition Accuracy [Inaccurate]",
                                  "Cognitive Flexibility * Speaker * Accuracy"),
                  dv.labels = "Perceived Listening Effort")

performance::test_performance(m13, m17)

```

### Model 18

```{r,warning = F, message = F}

m18 <- glmmTMB(effort_rating ~ trial_c + speaker*rep_acc + 
                 speaker*scale(list_sort_c, scale = F) + speaker*scale(card_sort_c, scale = F) +
                 rep_acc*scale(list_sort_c, scale = F) + rep_acc*scale(card_sort_c, scale = F) +
                 speaker*rep_acc*scale(pattern_c, scale = F) +
                (trial_c|subject) + (trial_c|code), data = ple)
sjPlot::tab_model(m18, 
                  pred.labels = c("Intercept", "Trial Number", "Speaker [ALS]",
                                  "Repetition Accuracy [Inaccurate]", "Working Memory", "Cognitive Flexibility", 
                                  "Processing Speed", "Speaker * Repetition Accuracy",
                                  "Working Memory * Speaker [ALS]", "Cognitive Flexibility * Speaker [ALS]", 
                                  "Working Memory * Repetition Accuracy [Inaccurate]",
                                  "Cognitive Flexibility * Repetition Accuracy [Inaccurate]",
                                  "Processing Speed * Speaker [ALS]",
                                  "Processing Speed * Repetition Accuracy [Inaccurate]",
                                  "Processing Speed * Speaker * Accuracy"),
                  dv.labels = "Perceived Listening Effort")

performance::test_performance(m13, m18)


```

### Best Fitting Final Model

Based on the model-building steps above, model 13 is the best fitting model for the perceived listening effort ratings. Since the interaction between speaker and repetition accuracy was not significant during any model building steps, that was removed from the model. Removal of this interaction did not significantly impact model performance. Model assumptions were also visually checked. Most assumptions appear to be met.

The final model take-aways, in reference to the cognitive measures of interest, are:

-   The interaction between working memory and speaker: On average, when listening to the speaker with ALS, listeners with higher working memory scores rated effort higher.

-   The interaction between cognitive flexibility and speaker: On average, when listening to the speaker with ALS, listeners with higher cognitive flexibility scores rated effort lower.

-   The interaction between working memory and repetition accuracy: On average, listeners with higher working memory scores rated effort phrases they did not accurately recognized lower.

-   The interaction between cognitive flexibility and repetition accuracy: On average, listeners with higher cognitive flexibility scores rated effort higher for phrases they did not accurately recognize.

-   The three way interactions between speaker, repetition accuracy, and each of the cognitive measures was tested. None of these interactions were significant.

```{r, warning = F, message = F}

m13b <- glmmTMB(effort_rating ~ trial_c + speaker + rep_acc + 
                 speaker*scale(list_sort_c, scale = F) + speaker*scale(card_sort_c, scale = F) +
                 rep_acc*scale(list_sort_c, scale = F) + rep_acc*scale(card_sort_c, scale = F) +
                (trial_c|subject) + (trial_c|code), data = ple)
sjPlot::tab_model(m13b, 
                  pred.labels = c("Intercept", "Trial Number", "Speaker [ALS]",
                                  "Repetition Accuracy [Inaccurate]", "Working Memory", "Cognitive Flexibility",
                                  "Working Memory * Speaker [ALS]", "Cognitive Flexibility * Speaker [ALS]", 
                                  "Working Memory * Repetition Accuracy [Inaccurate]",
                                  "Cognitive Flexibility * Repetition Accuracy [Inaccurate]"),
                  dv.labels = "Perceived Listening Effort",
                  show.std = T,
                  file = "Tables/ple_model.html")

performance::test_performance(m13, m13b)
performance::check_model(m0)

```
